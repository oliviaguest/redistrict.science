function validPreference(email){if(email==="congdist"||email==="clusters"){return true}return false}function validateHuman(honeypot){if(honeypot){console.log("Robot Detected!");return true}else{console.log("Welcome Human!")}}function getFormData(){var form=document.getElementById("gform");var elements=form.elements;var fields=Object.keys(elements).map(function(k){if(elements[k].name!==undefined){return elements[k].name}else if(elements[k].length>0){return elements[k].item(0).name}}).filter(function(item,pos,self){return self.indexOf(item)==pos&&item});var data={};console.log(fields);fields.forEach(function(k){data[k]=elements[k].value;var str="";if(elements[k].type==="checkbox"){str=str+elements[k].checked+", ";data[k]=str.slice(0,-2)}else if(elements[k].length){for(var i=0;i<elements[k].length;i++){if(elements[k].item(i).checked){str=str+elements[k].item(i).value+", ";data[k]=str.slice(0,-2)}}}});data.formDataNameOrder=JSON.stringify(fields);data.formGoogleSheetName=form.dataset.sheet||"responses";data.formGoogleSendEmail=form.dataset.email||"";console.log(data);return data}function handleFormSubmit(event){event.preventDefault();var data=getFormData();if(validateHuman(data.honeypot)){return false}if(!validPreference(data.preference)){document.getElementById("warning").style.display="block";return false}else{var url=event.target.action;var xhr=new XMLHttpRequest;xhr.open("POST",url);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.onreadystatechange=function(){console.log(xhr.status,xhr.statusText);console.log(xhr.responseText);document.getElementById("gform").style.display="none";document.getElementById("thankyou_message").style.display="block";return};var encoded=Object.keys(data).map(function(k){return encodeURIComponent(k)+"="+encodeURIComponent(data[k])}).join("&");xhr.send(encoded)}}function loaded(){console.log("contact form submission handler loaded successfully");var form=document.getElementById("gform");form.addEventListener("submit",handleFormSubmit,false)}document.addEventListener("DOMContentLoaded",loaded,false);$.getJSON("/json/states_hash.json",function(dict){$("#feedback").css("display","initial");var key=0;for(key in dict){var value=dict[key];$("#state").append($("<option/>").attr("value",key).text(dict[key]+" ("+key+")"))}});var button=document.getElementById("next");button.addEventListener("click",handleFormNext,false);var radio=document.getElementById("radio");radio.addEventListener("click",hideWarning,false);function placeImage(state){$("#left-image").attr("src","/images/congressional_district_plots/"+state+".png");$("#right-image").attr("src","/images/best_plots/"+state+".png");document.getElementById("left-radio-text").innerHTML="Existing Solution";document.getElementById("right-radio-text").innerHTML="Clustering Solution";document.getElementById("clusters-right").value="True"}function hideWarning(event){document.getElementById("warning").style.display="none"}function handleFormNext(event){event.preventDefault();var user=$.get("https://ipinfo.io?token=f26b5ab20fec6f",function(response){document.getElementById("city").value=response.city;document.getElementById("country").value=response.country;document.getElementById("hostname").value=response.hostname;document.getElementById("ip").value=response.ip;document.getElementById("loc").value=response.loc;document.getElementById("org").value=response.org;document.getElementById("postal").value=response.postal;document.getElementById("region").value=response.region},"jsonp");var data=getFormData();if(validateHuman(data.honeypot)){return false}console.log(data.state);placeImage(data.state);document.getElementById("preference-q").innerHTML="Which of the following congressional district maps do you prefer for "+data.state+"?";$("#submit").css("display","block");$("#radio").css("display","initial");$("#next").css("display","none");$("#state").css("display","none");$("#label-state").css("display","none")}
